<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
    <title>Sudoku Example</title>
    <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" href="./favicon.ico">
        <link href="./css/main.css" rel="stylesheet" type="text/css">
        <!--link href="./css/responsive.css" rel="stylesheet" type="text/css"-->
        
        <link href="./bower/responsive/build/responsive.css" rel="stylesheet" type="text/css">
        <script src="./bower/modernizer/modernizr.js"></script>
</head>
<body>


<style>
    
    html body
    {   
        margin:0px;
        padding:0px;
    }

    .game-board
    {
        display:inline-block;
        background-color:#fff;
        height:auto;
        width:auto;
        border:4px solid #000;
        max-width: 296px;
        background-color:#333;
    }

    .game-board .box
    {
        position: relative;
        float: left;
        
        background-color:#555;
        width:30px;
        height:30px;
        line-height: 28px;
        border: 1px solid #666;   
        margin:1px;   
    }

    .game-board .box:hover
    {
        background-color:#777;
    }

    .game-board .box input[type='text']
    {
          font-family: Segoe UI, Arial;
          font-size: 30px;
          color: #FFFFFF;
          width: 30px;
          height: 30px;
          padding: 0px;
          border: 0px;
          background: none !important;
          text-align: center;
          vertical-align: middle;
          position: relative;
          left: -1px;
    }
    .game-board .odd
    {
        background-color: #666;
    }

    .game-board .odd:hover
    {
        background-color: #888;   
    }

</style>

<div class="game-board"></div>

<p>
<h1>Rules</h1>
    <div>1. Number can appear only once on each row:</div>
    <div>2. Number can appear only once on each column:</div>
    <div>3. Number can appear only once on each region:</div>
</p>



<script src="./bower/jquery/dist/jquery.min.js"></script>
<script type="text/javascript">

    $(document).ready(function(e){
        init(".game-board");
    });


    function init(elm)
    {
        console.log("init()");

        renderGameBoard( elm );
    }

    function renderGameBoard(elm)
    {
        console.log("renderGameBoard()elm:", elm );
        var box_html  = "\
            <div class='box {{is_odd}}'>\
                 <form>\
                     <input type='hidden' name='id' value='{{id}}' /> \
                     <input type='hidden' name='col_id' value='{{col_id}}' /> \
                     <input type='hidden' name='row_id' value='{{row_id}}' /> \
                     <input type='hidden' name='quad-col' value={{quad_col}}' /> \
                     <input type='hidden' name='quad-id' value={{quad_id}}' /> \
                 </form>\
                 <input type='text' name='edit-input' value='' maxlength='1' onkeypress='return event.charCode >= 48 && event.charCode <= 57' /> \
            </div>";

        var html = "";
        var row = 0;
        var col = 0;
        var quad_col = 0;
        var base_quad = 0;
        var quad_id = 0;
        var quad = 0;
        var offset = 0;

        for(var i=0; i<81; i++)
        {
            var tmpl = box_html;

            if( col >= 9 ){
                col = 0;
                row++;
            }

                quad_col = col % 3;
                quad = Math.floor( col / 3 );
                offset = i%27;

                quad_id = base_quad + quad;
            if( quad_id == 0 || 
                 quad_id == 2 || 
                 quad_id == 4 || 
                 quad_id == 6 || 
                 quad_id == 8 )
            {
                tmpl = tmpl.split("{{is_odd}}").join("odd");
            }else{
                tmpl = tmpl.split("{{is_odd}}").join("");
            }
            
            tmpl = tmpl.split("{{id}}").join(i);
            tmpl = tmpl.split("{{row_id}}").join(row);
            tmpl = tmpl.split("{{col_id}}").join(col);
            tmpl = tmpl.split("{{quad_col}}").join(quad_col);
            tmpl = tmpl.split("{{quad_id}}").join(quad_id);

            if( quad == 2 && col == 8 && offset == 26 )
            {
                //3 quadrants per row
                base_quad+=3;
            }

            col++;
            html += tmpl;
        }
        $(elm).empty();
        $(elm).html(html);
        $(elm).find(".box input[type='text']").click(clickHandler);
        $(elm).find(".box input[type='text']").on("change", inputHandler );
        //initUI(elm);
    }

    function inputHandler(e)
    {
        e.preventDefault();
        var elm      = $(e.target).closest(".box");
        var id       = elm.find("input[name='id']").val();
        var col_id   = elm.find("input[name='col_id']").val();
        var row_id   = elm.find("input[name='row_id']").val();
        var quad_col = elm.find("input[name='quad-col']").val();
        var quad_id  = elm.find("input[name='quad-id']").val();
        var val     = elm.find("input[name='edit-input']").val();
            val = ( val == "" )? -1 : Number( val );
        console.log("inputHandler():id:", id );
        check( val, row_id, col_id, quad_id );
    }

    function clickHandler(e)
    {   
        e.preventDefault();
        var elm      = $(e.target).closest(".box");
        var id       = elm.find("input[name='id']").val();
        var col_id     = elm.find("input[name='col_id']").val();
        var row_id     = elm.find("input[name='row_id']").val();
        var quad_col = elm.find("input[name='quad-col']").val();
        var quad_id  = elm.find("input[name='quad-id']").val();
        var val     = elm.find("input[name='edit-input']").val();
            val = ( val == "" )? -1 : Number( val );
        //console.log("clickHandler():id:", id );
    }

    function check( val, row_id, col_id, quad_id )
    {
        console.log( "move:", val, row_id, col_id, quad_id );
        isRowOk = getRowById( row_id );
        isColOk = getColById( col_id );
        isQuadOk = getQuadBy( quad_id );
        
        return isRowOk && isColOk && isQuadOk;
    }


    function getRowById( row_id)
    {
        console.log("checkRow():row_id", row_id );
        var elms = $(".game-board .box input[name='row_id'][value='"+ row_id +"'] ");
        var values = [];
        //var hasDuplicate;
        $.each( elms, function(index, elm){
            
            var box = $(elm).closest(".box");
            var val = $(box).find("input[name='edit-input']").val();
                
                val = ( val == "" )? -1 : Number( val );
//                console.log("val:", val);
                values.push( val );
                
        });
//        console.log( "values:", values );
        return values;
    }

    function getColById( col_id)
    {
        console.log("getColById():col_id", col_id );
        var elms = $(".game-board .box input[name='col_id'][value='"+ col_id +"'] ");
        var values = [];
        //var hasDuplicate;
        $.each( elms, function(index, elm){
            
            var box = $(elm).closest(".box");
            var val = $(box).find("input[name='edit-input']").val();
                
                val = ( val == "" )? -1 : Number( val );
//                console.log("val:", val);
                values.push( val );
                
        });
        console.log( "values:", values );
        return values;
    }

    function getQuadBy( quad_id)
    {
        console.log("getQuadBy():quad_id", quad_id );
        var elms = $(".game-board .box input[name='quad_id'][value='"+ quad_id +"'] ");
        var values = [];
        //var hasDuplicate;
        $.each( elms, function(index, elm){
            
            var box = $(elm).closest(".box");
            var val = $(box).find("input[name='edit-input']").val();
                
                val = ( val == "" )? -1 : Number( val );
//                console.log("val:", val);
                values.push( val );
                
        });
//        console.log( "values:", values );
        return values;
    }

</script>


</body>
</html>